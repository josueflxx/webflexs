{% extends 'base.html' %}
{% load static %}

{% block title %}FLEXS - Repuestos de El√°sticos en Argentina{% endblock %}

{% block extra_head %}
<link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/home.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section id="inicio" class="hero">
    <div class="hero-overlay"></div>
    <div class="container hero-content">
        <div class="hero-text">
            <h1 class="hero-title">
                <span class="hero-title-line">Descubra la gama de</span>
                <span class="hero-title-line text-primary">productos FLEXS</span>
            </h1>
            <h2 class="hero-subtitle">Optimice el rendimiento de sus veh√≠culos</h2>
            <p class="hero-description">
                Expertos en repuestos para industrias de transporte.<br>
                Ayudando a empresas a mantenerse en movimiento.
            </p>
            <div class="hero-buttons">
                <a href="{% url 'catalog' %}" class="btn btn-primary btn-lg">
                    Ver Cat√°logo
                </a>
                {% if not user.is_authenticated %}
                <a href="{% url 'account_request' %}" class="btn btn-outline btn-lg">
                    Solicitar Cuenta
                </a>
                {% endif %}
            </div>
        </div>
        <div class="hero-visual">
            <div class="hero-circle"></div>
        </div>
    </div>
    <div class="hero-scroll">
        <a href="#nosotros">
            <span class="scroll-text">Scroll</span>
            <span class="scroll-arrow">‚Üì</span>
        </a>
    </div>
</section>

<!-- Nosotros Section -->
<section id="nosotros" class="section section-dark">
    <div class="container">
        <div class="section-header">
            <span class="section-number">01</span>
            <h2 class="section-title">Nosotros</h2>
        </div>
        <div class="about-grid">
            <div class="about-content">
                <h3>Expertos en Repuestos para Industrias de Transporte</h3>
                <p>
                    En <strong>Flexs</strong>, nos dedicamos a ofrecer repuestos de el√°stico de alta calidad
                    para camiones y acoplados. Nuestro amplio cat√°logo y nuestro compromiso con el servicio
                    al cliente nos convierten en la opci√≥n ideal para talleres, empresas con flotas de
                    veh√≠culos y distribuidoras.
                </p>
                <p>
                    Nuestro equipo dedicado est√° siempre disponible para ayudarte a encontrar las piezas
                    adecuadas y garantizar una experiencia de compra sin problemas, desde el pedido hasta
                    la entrega.
                </p>
                <div class="about-cta">
                    <p class="cta-text">
                        <strong>Estamos esperando su mensaje para conocerlo y brindarle una lista de precios a su
                            medida</strong>
                    </p>
                    <a href="#contacto" class="btn btn-primary">Contactanos</a>
                </div>
            </div>
            <div class="about-stats">
                <div class="stat-card">
                    <span class="stat-number">8000+</span>
                    <span class="stat-label">Productos</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">2000+</span>
                    <span class="stat-label">Clientes</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">30+</span>
                    <span class="stat-label">A√±os de experiencia</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Servicios Section -->
<section id="servicios" class="section">
    <div class="container">
        <div class="section-header">
            <span class="section-number">02</span>
            <h2 class="section-title">C√≥mo podemos ayudarlo?</h2>
        </div>
        <div class="services-grid">
            <div class="service-card">
                <div class="service-icon">üì¶</div>
                <h3>Amplio Cat√°logo, Amplio Stock</h3>
                <p>
                    M√°s de 8.000 productos disponibles con stock permanente para satisfacer
                    todas sus necesidades de repuestos.
                </p>
            </div>
            <div class="service-card">
                <div class="service-icon">üîß</div>
                <h3>Fabricaci√≥n Propia</h3>
                <p>
                    Producimos nuestras propias abrazaderas U-bolt con la m√°s alta calidad
                    y especificaciones precisas.
                </p>
                <a href="https://www.ubolt.com.ar" target="_blank" class="service-link">
                    Ver ubolt.com.ar ‚Üí
                </a>
            </div>
            <div class="service-card">
                <div class="service-icon">üöö</div>
                <h3>Entregas R√°pidas y Atenci√≥n Personalizada</h3>
                <p>
                    Env√≠os a todo el pa√≠s con rapidez y un equipo dedicado a resolver
                    todas sus consultas.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Productos Section -->
<section id="productos" class="section section-dark">
    <div class="container">
        <div class="section-header">
            <span class="section-number">03</span>
            <h2 class="section-title">Nuestros Productos</h2>
        </div>
        <div class="products-grid">
            <div class="product-category-card">
                <div class="category-icon">üî©</div>
                <h4>El√°sticos</h4>
            </div>
            <div class="product-category-card">
                <div class="category-icon">‚öôÔ∏è</div>
                <h4>Bujes</h4>
            </div>
            <div class="product-category-card">
                <div class="category-icon">üè≠</div>
                <h4>Fundici√≥n</h4>
            </div>
            <div class="product-category-card">
                <div class="category-icon">üîó</div>
                <h4>Pernos</h4>
            </div>
            <div class="product-category-card">
                <div class="category-icon">üîß</div>
                <h4>Buloner√≠a</h4>
            </div>
            <div class="product-category-card featured">
                <div class="category-icon">üî®</div>
                <h4>Abrazaderas</h4>
                <span class="featured-badge">Fabricaci√≥n propia</span>
            </div>
            <div class="product-category-card">
                <div class="category-icon">üí®</div>
                <h4>Suspensi√≥n Neum√°tica</h4>
            </div>
            <div class="product-category-card">
                <div class="category-icon">üìé</div>
                <h4>Insertos de El√°stico</h4>
            </div>
            <div class="product-category-card">
                <div class="category-icon">‚öñÔ∏è</div>
                <h4>Balancines</h4>
            </div>
        </div>
        <div class="products-cta">
            <a href="{% url 'catalog' %}" class="btn btn-primary btn-lg">Ver Cat√°logo Completo</a>
        </div>
    </div>
</section>

<!-- Contacto Section -->
<section id="contacto" class="section">
    <div class="container">
        <div class="section-header">
            <span class="section-number">04</span>
            <h2 class="section-title">Contacto</h2>
        </div>
        <div class="contact-grid">
            <div class="contact-info">
                <div class="contact-item">
                    <span class="contact-icon">üìç</span>
                    <div>
                        <h4>Direcci√≥n</h4>
                        <p>{{ site_settings.company_address }}</p>
                    </div>
                </div>
                <div class="contact-item">
                    <span class="contact-icon">üìû</span>
                    <div>
                        <h4>Tel√©fonos</h4>
                        <p>
                            <a href="tel:{{ site_settings.company_phone }}">{{ site_settings.company_phone }}</a><br>
                            {% if site_settings.company_phone_2 %}
                            <a href="tel:{{ site_settings.company_phone_2 }}">{{ site_settings.company_phone_2 }}</a>
                            {% endif %}
                        </p>
                    </div>
                </div>
                <div class="contact-item">
                    <span class="contact-icon">‚úâÔ∏è</span>
                    <div>
                        <h4>Email</h4>
                        <p><a href="mailto:{{ site_settings.company_email }}">{{ site_settings.company_email }}</a></p>
                    </div>
                </div>
            </div>
            <div class="contact-actions">
                <h3>¬øListo para empezar?</h3>
                <p>Solicit√° tu cuenta y acced√© a precios especiales para tu negocio.</p>
                <div class="contact-buttons">
                    {% if user.is_authenticated %}
                    <a href="{% url 'catalog' %}" class="btn btn-primary btn-lg">Ir al Cat√°logo</a>
                    {% else %}
                    <a href="{% url 'account_request' %}" class="btn btn-primary btn-lg">Solicitar Cuenta</a>
                    <a href="{% url 'login' %}" class="btn btn-outline btn-lg">Iniciar Sesi√≥n</a>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="contact-map-wrapper">
            <h3 class="contact-map-title">Ubicacion</h3>
            <div
                id="contactMap"
                class="contact-map-frame"
                data-address="{{ site_settings.company_address }}"
                data-company="FLEXS">
            </div>
            <p id="contactMapStatus" class="contact-map-hint">Cargando mapa interactivo...</p>
            <div class="contact-map-links">
                <a
                    class="contact-map-link"
                    href="https://www.google.com/maps/search/?api=1&query={{ site_settings.company_address|urlencode }}"
                    target="_blank"
                    rel="noopener noreferrer">
                    Abrir en Google Maps
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin="">
</script>
<script>
    (function () {
        const mapElement = document.getElementById('contactMap');
        const statusElement = document.getElementById('contactMapStatus');
        if (!mapElement || typeof L === 'undefined') return;

        const address = (mapElement.dataset.address || '').trim() || 'San Martin, Buenos Aires, Argentina';
        const company = (mapElement.dataset.company || 'FLEXS').trim();
        const fallbackCoords = [-34.5745, -58.5348];

        const map = L.map(mapElement, {
            scrollWheelZoom: true,
            zoomControl: true,
        }).setView(fallbackCoords, 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap',
        }).addTo(map);

        const marker = L.marker(fallbackCoords).addTo(map);
        marker.bindPopup('<strong>' + company + '</strong><br>' + address).openPopup();

        function setStatus(text, hasError) {
            if (!statusElement) return;
            statusElement.textContent = text;
            statusElement.classList.toggle('is-error', Boolean(hasError));
        }

        setStatus('Mostrando ubicaci√≥n aproximada. Ajustando ubicaci√≥n exacta...');

        fetch('https://nominatim.openstreetmap.org/search?format=json&limit=1&q=' + encodeURIComponent(address), {
            headers: { 'Accept': 'application/json' },
        })
            .then(function (response) {
                if (!response.ok) throw new Error('geocode_failed');
                return response.json();
            })
            .then(function (results) {
                if (!Array.isArray(results) || !results.length) throw new Error('no_results');
                const lat = Number(results[0].lat);
                const lon = Number(results[0].lon);
                if (!Number.isFinite(lat) || !Number.isFinite(lon)) throw new Error('invalid_coords');

                const realCoords = [lat, lon];
                map.setView(realCoords, 16);
                marker.setLatLng(realCoords);
                marker.bindPopup('<strong>' + company + '</strong><br>' + address).openPopup();
                setStatus('Ubicaci√≥n exacta encontrada.');
            })
            .catch(function () {
                setStatus('No se pudo obtener ubicaci√≥n exacta. Mostrando aproximada.', true);
            });
    })();
</script>
{% endblock %}
